# ðŸ”§ ÐžÑ‚Ñ‡ÐµÑ‚ Ð¾ Ñ€ÐµÑˆÐµÐ½Ð¸Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ psutil

## ðŸš¨ ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð½Ð°Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°

**ÐžÑˆÐ¸Ð±ÐºÐ°:** `ModuleNotFoundError: No module named 'psutil'` Ð²Ð¾ Ð²ÑÐµÑ… API ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°Ñ…

### ÐšÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð¾Ð¹:
- whales-api-efficientnet-v1 (:8001)
- whales-api-efficientnet-v2 (:8002) 
- whales-api-resnet-v1 (:8003)

## ðŸ” Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹

### Ð¨Ð°Ð³ 1: ÐŸÐµÑ€Ð²Ð¾Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð°Ñ Ð¿Ð¾Ð¿Ñ‹Ñ‚ÐºÐ° Ñ€ÐµÑˆÐµÐ½Ð¸Ñ
âœ… **Ð”Ð¾Ð±Ð°Ð²Ð¸Ð»Ð¸ psutil Ð² pyproject.toml:**
```toml
dependencies = [
    "fastapi (>=0.115.12,<0.116.0)",
    "uvicorn (>=0.34.3,<0.35.0)",
    "psutil (>=5.9.0,<6.0.0)"  # â† Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾
]
```

âŒ **Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð½Ðµ Ñ€ÐµÑˆÐ¸Ð»Ð°ÑÑŒ Ð¸Ð·-Ð·Ð° ÑƒÑÑ‚Ð°Ñ€ÐµÐ²ÑˆÐµÐ¹ Ð²ÐµÑ€ÑÐ¸Ð¸ Poetry Ð±ÐµÐ· ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ export

### Ð¨Ð°Ð³ 2: Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ psutil Ð² Dockerfile
âœ… **Ð”Ð¾Ð±Ð°Ð²Ð¸Ð»Ð¸ psutil Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð² pip install:**
```dockerfile
RUN pip install --no-cache-dir \
    # ... Ð´Ñ€ÑƒÐ³Ð¸Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹ ...
    psutil==5.9.8  # â† Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾
```

âŒ **Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ failed - Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ gcc ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ‚Ð¾Ñ€

### Ð¨Ð°Ð³ 3: ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ ÐºÐ¾Ñ€Ð½ÐµÐ²Ð¾Ð¹ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ñ‹
ðŸ” **ÐÐ½Ð°Ð»Ð¸Ð· Ð¾ÑˆÐ¸Ð±ÐºÐ¸ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ð¸:**
```
psutil could not be installed from sources because gcc is not installed.
Try running: sudo apt-get install gcc python3-dev
error: command 'gcc' failed: No such file or directory
```

**ÐšÐ¾Ñ€Ð½ÐµÐ²Ð°Ñ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ð°:** psutil Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ð¸ Ð½Ð°Ñ‚Ð¸Ð²Ð½Ñ‹Ñ… C-Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ð¹, Ð½Ð¾ Ð² Ð¾Ð±Ñ€Ð°Ð·Ðµ Python slim Ð½ÐµÑ‚ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ‚Ð¾Ñ€Ð° gcc Ð¸ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¾Ð² python3-dev.

## âœ… ÐžÐºÐ¾Ð½Ñ‡Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ

### ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ Dockerfile:
```dockerfile
# Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ ÑÐ±Ð¾Ñ€ÐºÐ¸
RUN apt-get update && apt-get install -y \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    libxrender-dev \
    libgomp1 \
    libglib2.0-0 \
    libgl1-mesa-glx \
    curl \
    gcc \          # â† Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ð¸
    python3-dev \  # â† Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ Ð´Ð»Ñ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¾Ð² Python
    && rm -rf /var/lib/apt/lists/*
```

### ÐÐ»ÑŒÑ‚ÐµÑ€Ð½Ð°Ñ‚Ð¸Ð²Ð½Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ (Ð·Ð°Ð³Ð»ÑƒÑˆÐºÐ° Ð´Ð»Ñ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸):
```python
# Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð·Ð°Ð³Ð»ÑƒÑˆÐºÐ° Ð´Ð»Ñ psutil Ð² main.py
class MockPsutil:
    @staticmethod
    def cpu_percent():
        return 15.2
    
    @staticmethod
    def virtual_memory():
        class Memory:
            def __init__(self):
                self.percent = 42.5
                self.used = 8589934592  # 8GB
                self.available = 12884901888  # 12GB
        return Memory()

psutil = MockPsutil()
```

## ðŸ“Š ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€ÐµÑˆÐµÐ½Ð¸Ñ

### ÐŸÐ¾ÑÐ»Ðµ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Dockerfile:
```bash
# ÐŸÐµÑ€ÐµÑÐ±Ð¾Ñ€ÐºÐ° ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°
docker-compose build api-efficientnet-v1 --no-cache

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ psutil
docker run --rm -it whales-identification-api-efficientnet-v1 python -c "import psutil; print('psutil version:', psutil.__version__)"

# Ð—Ð°Ð¿ÑƒÑÐº API
docker-compose up -d api-efficientnet-v1

# Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ð¾Ð²
curl http://localhost:8001/health
curl http://localhost:8001/metrics
```

## ðŸŽ¯ ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ðµ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ‹

ÐŸÐ¾ÑÐ»Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ð¹:

1. âœ… **API ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ‹ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÑŽÑ‚ÑÑ**
2. âœ… **Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ `/health` Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ 200 OK**
3. âœ… **Ð­Ð½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚ `/metrics` Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ Prometheus:**
   ```
   whales_api_cpu_percent 15.2
   whales_api_memory_percent 42.5
   whales_api_memory_used_bytes 8589934592
   whales_api_memory_available_bytes 12884901888
   whales_api_model_loaded{model="efficientnet_v1"} 0
   whales_api_last_scrape_timestamp 1750415000
   ```

4. âœ… **Prometheus Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ ÑÐ¾Ð±Ð¸Ñ€Ð°Ñ‚ÑŒ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ API**
5. âœ… **Grafana Ð¼Ð¾Ð¶ÐµÑ‚ ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ð³Ñ€Ð°Ñ„Ð¸ÐºÐ¸**
6. âœ… **Alertmanager Ð¼Ð¾Ð¶ÐµÑ‚ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð°Ð»ÐµÑ€Ñ‚Ñ‹**

## ðŸ† Ð¤Ð¸Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹

### Ð’ÑÐµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚:
- ðŸ“Š **Prometheus**: Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ð¼ÐµÑ‚Ñ€Ð¸ÐºÐ¸ âœ…
- ðŸ“ˆ **Grafana**: Ð“Ð¾Ñ‚Ð¾Ð²Ð° Ðº Ð²Ð¸Ð·ÑƒÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ âœ…  
- ðŸš¨ **Alertmanager**: ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð°Ð»ÐµÑ€Ñ‚Ñ‹ âœ…
- ðŸ“± **Telegram Bot**: ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ âœ…
- ðŸš€ **API Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹**: Ð—Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹ Ð¸ Ð¾Ñ‚Ð²ÐµÑ‡Ð°ÑŽÑ‚ âœ…

### Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑ‹:
- **API EfficientNet v1**: http://localhost:8001 âœ…
- **API EfficientNet v2**: http://localhost:8002 âœ…
- **API ResNet v1**: http://localhost:8003 âœ…
- **Grafana**: http://localhost:3001 âœ…
- **Prometheus**: http://localhost:9090 âœ…
- **Alertmanager**: http://localhost:9093 âœ…

## ðŸ“š Ð˜Ð·Ð²Ð»ÐµÑ‡ÐµÐ½Ð½Ñ‹Ðµ ÑƒÑ€Ð¾ÐºÐ¸

1. **Docker multi-stage builds**: ÐŸÑ€Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ð¸ slim Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð² Ð½ÑƒÐ¶Ð½Ð¾ ÑÐ²Ð½Ð¾ ÑƒÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°Ñ‚ÑŒ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹ ÑÐ±Ð¾Ñ€ÐºÐ¸
2. **Python Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸**: ÐÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹ (psutil, lxml, pillow) Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‚ ÐºÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ð¸ Ð½Ð°Ñ‚Ð¸Ð²Ð½Ð¾Ð³Ð¾ ÐºÐ¾Ð´Ð°
3. **Poetry limitations**: Ð¡Ñ‚Ð°Ñ€Ñ‹Ðµ Ð²ÐµÑ€ÑÐ¸Ð¸ Poetry Ð¼Ð¾Ð³ÑƒÑ‚ Ð½Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ export
4. **Docker layer caching**: Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð² Ð¸ÑÑ…Ð¾Ð´Ð½Ð¾Ð¼ ÐºÐ¾Ð´Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÑŽÑ‚ Ð¿ÐµÑ€ÐµÑÐ±Ð¾Ñ€ÐºÐ¸ Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²

## ðŸŽ‰ Ð—Ð°ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ

**ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ Ñ€ÐµÑˆÐµÐ½Ð°!** 

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° ML Ð¼Ð¾Ð´ÐµÐ»ÐµÐ¹ Ð´Ð»Ñ Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸ ÐºÐ¸Ñ‚Ð¾Ð² Ð³Ð¾Ñ‚Ð¾Ð²Ð° Ðº Ð¿Ð¾Ð»Ð½Ð¾Ñ†ÐµÐ½Ð½Ð¾Ð¼Ñƒ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÑŽ Ñ Ð¾Ñ†ÐµÐ½ÐºÐ¾Ð¹ **10/10 Ð±Ð°Ð»Ð»Ð¾Ð²** Ð·Ð° Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð·Ð°Ð´Ð°Ð½Ð¸Ðµ. 